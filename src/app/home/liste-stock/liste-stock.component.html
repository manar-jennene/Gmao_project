<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="main-container">
  <div class="pd-ltr-20 xs-pd-20-10">
    <div class="min-height-200px">

      <!-- En-t√™te de la page -->
   <!-- En-t√™te de la page -->
<div class="page-header mb-3">
  <div class="row align-items-end">
    <div class="col-md-6 col-sm-12">
      <div class="title">
        <h4>Gestion de Stock</h4>
      </div>
      <nav aria-label="breadcrumb" role="navigation">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/index">Accueil</a></li>
          <li class="breadcrumb-item active" aria-current="page">Stock</li>
        </ol>
      </nav>
    </div>

    <!-- Bouton Ajouter Stock -->
 <!-- Bouton pour ouvrir le modal -->
<div class="d-flex justify-content-end mb-3">
  <button class="btn btn-success" (click)="showAddModal = true">
    + Nouveau Stock
  </button>
</div>

  </div>
</div>


      <!-- Tableau des stocks -->
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-primary text-white rounded-top-4">
        </div>

        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead class="custom-thead">
              <tr>
                <th>Nom</th>
                <th>R√©f√©rence</th>
                <th>Description</th>
                <th>Quantit√© Disponible</th>
                <th>Seuil Minimum</th>
                <th>Cat√©gorie</th>
                <th>Fournisseur</th>
                <th>Date d'ajout</th>
                <th>Actions</th>

              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stock of paginatedStocks" class="table-row">
                <td class="fw-semibold text-dark">{{ stock.nom }}</td>
                <td><span class="badge bg-info text-dark">{{ stock.reference }}</span></td>
                <td>{{ stock.description }}</td>
                <td [ngClass]="{'text-danger fw-bold': stock.quantite_disponible <= stock.seuil_minimum, 'text-success fw-bold': stock.quantite_disponible > stock.seuil_minimum}">
                  {{ stock.quantite_disponible }}
                </td>
                <td>{{ stock.seuil_minimum }}</td>
                <td><span class="badge bg-secondary">{{ stock.categorie?.nom || 'N/A' }}</span></td>
                <td><span class="badge bg-warning text-dark">{{ stock.fournisseur?.nom || 'N/A' }}</span></td>
                <td>{{ stock.created_at | date:'dd/MM/yyyy' }}</td>
                <!-- Dans le thead -->

<!-- Dans le tbody, √† la fin de chaque ligne -->
              <td>
  <button class="btn btn-sm btn-info me-1" (click)="editStock(stock)">
    ‚úèÔ∏è
  </button>
  <button class="btn btn-sm btn-danger" (click)="confirmDelete(stock)">
    üóëÔ∏è
  </button>

                    </td>

              </tr>
            </tbody>
          </table>
        </div>

     <!-- Pagination en bas -->
<div class="d-flex justify-content-center align-items-center my-3 gap-2">
  <button class="btn btn-sm btn-outline-primary"
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1">
    ‚¨Ö
  </button>

  <span class="mx-2">Page {{ currentPage }} / {{ totalPages }}</span>

  <button class="btn btn-sm btn-outline-primary"
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages">
    ‚û°
  </button>
</div>


<!-- Modal d'ajout de Stock -->
<div class="modal" tabindex="-1" [ngClass]="{'show d-block': showAddModal}" style="background: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Ajouter un Stock</h5>
        <button type="button" class="btn-close" (click)="showAddModal = false"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="stockForm" (ngSubmit)="onSubmit()">
          <div class="row g-3">
            <div class="col-md-6">
              <label>Nom</label>
              <input type="text" class="form-control" formControlName="nom" required>
            </div>
            <div class="col-md-6">
              <label>R√©f√©rence</label>
              <input type="text" class="form-control" formControlName="reference" required>
            </div>
            <div class="col-12">
              <label>Description</label>
              <textarea class="form-control" formControlName="description" rows="2"></textarea>
            </div>
            <div class="col-md-6">
              <label>Quantit√© Disponible</label>
              <input type="number" class="form-control" formControlName="quantite_disponible" required>
            </div>
            <div class="col-md-6">
              <label>Seuil Minimum</label>
              <input type="number" class="form-control" formControlName="seuil_minimum" required>
            </div>
            <div class="col-md-6">
              <label>Cat√©gorie</label>
              <select class="form-select" formControlName="categorie_id">
                <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.nom }}</option>
              </select>
            </div>
            <div class="col-md-6">
              <label>Fournisseur</label>
              <select class="form-select" formControlName="fournisseur_id">
                <option *ngFor="let user of fournisseurs" [value]="user.id">{{ user.nom }}</option>
              </select>
            </div>
            <div class="col-md-6">
              <label>Date d'ajout</label>
              <input type="date" class="form-control" formControlName="created_at" required>
            </div>
          </div>
          <div class="mt-3 text-end">
            <button type="button" class="btn btn-secondary me-2" (click)="showAddModal = false">Annuler</button>
            <button type="submit" class="btn btn-primary">Ajouter</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Modal de confirmation suppression -->
<div class="modal" tabindex="-1" [ngClass]="{'show d-block': showDeleteModal}" style="background: rgba(0,0,0,0.5);">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Confirmation</h5>
        <button type="button" class="btn-close" (click)="showDeleteModal = false"></button>
      </div>
      <div class="modal-body">
        <p>Voulez-vous vraiment supprimer ce stock ?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="showDeleteModal = false">Annuler</button>
        <button class="btn btn-danger" (click)="deleteStockConfirmed()">Oui, Supprimer</button>
      </div>
    </div>
  </div>
</div>


      </div>

    </div>
  </div>
</div>



